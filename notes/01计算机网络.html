<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>计算机网络 | PurpleFish’s Blog</title>
    <meta name="generator" content="VuePress 1.9.10">
    
    <meta name="description" content="这是一个基于 VuePress 的博客">
    
    <link rel="preload" href="/PurpleFish_Blog/assets/css/0.styles.2b0a0130.css" as="style"><link rel="preload" href="/PurpleFish_Blog/assets/js/app.ff8256e3.js" as="script"><link rel="preload" href="/PurpleFish_Blog/assets/js/2.43a24c62.js" as="script"><link rel="preload" href="/PurpleFish_Blog/assets/js/1.6ee28ae7.js" as="script"><link rel="preload" href="/PurpleFish_Blog/assets/js/22.125fbbec.js" as="script"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/10.b04fc0d4.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/11.5a32c356.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/12.6311bbb4.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/13.9f626855.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/14.2a433a45.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/15.f4a73f35.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/16.0da34392.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/17.4ae81fed.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/18.1198418d.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/19.9efc8374.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/20.5d622c1c.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/21.8daff977.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/23.51842491.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/24.d29f9239.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/25.50b537e5.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/26.a7803a32.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/27.3a646cab.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/28.0f04383d.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/29.516bbd6e.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/3.a5bdcc19.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/30.0c3e2a58.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/31.c55b1b7b.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/32.6f42b27f.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/33.5630dc9b.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/34.506ccca3.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/35.525f91fc.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/36.3ed31312.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/37.e0c7ab78.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/38.94c28a78.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/39.0f6ab893.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/4.17635ff9.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/40.31380cbc.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/41.7862120c.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/42.e1b28fea.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/43.bba45c93.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/44.f543bcf0.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/45.b3468082.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/46.ce165ee3.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/47.cd346d62.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/48.f34fd7c9.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/49.04a56087.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/5.bb8f33b7.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/50.944cf170.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/51.875167a9.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/52.37cbc86f.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/53.afa7aef4.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/54.f01744cd.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/55.bf004fec.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/56.86541d80.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/57.851b13ff.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/58.9979010b.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/59.80a18be0.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/6.46359932.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/60.3913a449.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/61.95d9a272.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/62.5e28c5de.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/63.23644217.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/64.e291cd20.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/7.720220fb.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/vendors~docsearch.94b65286.js">
    <link rel="stylesheet" href="/PurpleFish_Blog/assets/css/0.styles.2b0a0130.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/PurpleFish_Blog/" class="home-link router-link-active"><!----> <span class="site-name">PurpleFish’s Blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/PurpleFish_Blog/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/PurpleFish_Blog/notes/" class="nav-link router-link-active">
  笔记
</a></div><div class="nav-item"><a href="/PurpleFish_Blog/articles/" class="nav-link">
  文章
</a></div><div class="nav-item"><a href="/PurpleFish_Blog/projects/" class="nav-link">
  项目集
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/PurpleFish_Blog/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/PurpleFish_Blog/notes/" class="nav-link router-link-active">
  笔记
</a></div><div class="nav-item"><a href="/PurpleFish_Blog/articles/" class="nav-link">
  文章
</a></div><div class="nav-item"><a href="/PurpleFish_Blog/projects/" class="nav-link">
  项目集
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>计算机网络</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/PurpleFish_Blog/notes/01%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C.html#计算机网络" class="sidebar-link">计算机网络</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/PurpleFish_Blog/notes/01%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C.html#缓存机制-详细笔记-强缓存-协商缓存" class="sidebar-link">缓存机制 详细笔记 强缓存  协商缓存</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/PurpleFish_Blog/notes/01%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C.html#_5-1-强缓存" class="sidebar-link">5.1 强缓存</a></li><li class="sidebar-sub-header"><a href="/PurpleFish_Blog/notes/01%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C.html#_5-2-协商缓存" class="sidebar-link">5.2 协商缓存</a></li></ul></li><li><a href="/PurpleFish_Blog/notes/01%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C.html#jwt" class="sidebar-link">jwt</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/PurpleFish_Blog/notes/01%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C.html#前端只需要会-5-件事" class="sidebar-link">前端只需要会 5 件事</a></li><li class="sidebar-sub-header"><a href="/PurpleFish_Blog/notes/01%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C.html#_20-行骨架代码-可直接用" class="sidebar-link">20 行骨架代码（可直接用）</a></li><li class="sidebar-sub-header"><a href="/PurpleFish_Blog/notes/01%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C.html#📦-额外-3-个可选工具包" class="sidebar-link">📦 额外 3 个可选工具包</a></li><li class="sidebar-sub-header"><a href="/PurpleFish_Blog/notes/01%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C.html#🧠-记住-3-个核心口诀" class="sidebar-link">🧠 记住 3 个核心口诀</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="计算机网络"><a href="#计算机网络" class="header-anchor">#</a> 计算机网络</h2> <h4 id="osi七层协议参考模型"><a href="#osi七层协议参考模型" class="header-anchor">#</a> OSI七层协议参考模型</h4> <ol><li>应用层（SMTP\FTP\HTTP）</li> <li>表示层（应用层）</li> <li>会话层（应用层）</li> <li>传输层（传输层）：TCP\UDP</li> <li>网络层（互联网层）：IP</li> <li>数据链路层（网络接口层）：以太网</li> <li>物理层（网络接口层）</li></ol> <p>发送的数据会在分层模型内传递，每到一层，就会附加该层的包首部–包含该层的协议的相关信息，包括MAC地址、IP地址和端口号。</p> <h4 id="tcp与udp的区别"><a href="#tcp与udp的区别" class="header-anchor">#</a> TCP与UDP的区别</h4> <ul><li>连接性：TCP面向连接；UDP是无连接的。（TCP需要三次握手，而UDP不需要握手）</li> <li>可靠性：TCP提供可靠的服务；UDP尽最大努力交付，即不保证可靠交付。（通过TCP连接传送的数据，无差错，不丢失，不重复，且按序到达;UDP则可能出现丢包，不保证顺序到达）</li> <li>面向对象：TCP面向字节流;UDP是面向报文的。（ 面向报文的是指发送方的UDP对应用层交下来的数据报文，不合并不拆分，只是在其上面加上首部后就交给了下面的网络层。）。</li> <li>差错拥塞控制：UDP没有差错和拥塞控制，因此网络出现拥塞不会使源主机的发送速率降低。（TCP拥塞控制，当另一端出现阻塞时，会降低发送速率）。</li> <li>系统开销：TCP首部开销20字节（具有报文段序号，应答序号，窗口大小等）;UDP的首部开销小，只有8个字节（2个字节的源端口，2个字节的目的端口，2个字节的报文长度，2个字节的校验和）。</li> <li>信道：TCP的逻辑通信信道是全双工的可靠信道，即可以流入也可以流出的信道；UDP则是不可靠信道。</li> <li>有序性：TCP是有序的字节流；UDP则是无序的。（这是由于tcp头部存在报文段的序号，而udp没有）</li></ul> <h5 id="tcp三次挥手"><a href="#tcp三次挥手" class="header-anchor">#</a> TCP三次挥手</h5> <p><img src="/PurpleFish_Blog/assets/img/01-1.eee030bc.png" alt="img"></p> <h5 id="dns缓存"><a href="#dns缓存" class="header-anchor">#</a> DNS缓存</h5> <p>(浏览器、系统、ISP、路由器、DNS服务器）
在一个请求链中，当某DNS服务器接收到一个DNS回答，它能将该回答中的信息缓存在本地存储器中。如果在DNS服务器中缓存了一台主机名/IP地址对，另一对相同主机名的查询到达该DNS服务器时，该DNS服务器就能够提供所需要的IP地址，即使它不是该主机名的权威服务器。由于主机名与IP地址之间的映射不是永久的，DNS服务器在一段时间之后将丢失缓存的信息。</p> <h4 id="http状态码"><a href="#http状态码" class="header-anchor">#</a> HTTP状态码</h4> <p>HTTP 400 – 请求无效</p> <p>HTTP 401.1 – 未授权：登录失败</p> <p>HTTP 401.2 – 未授权：服务器配置问题导致登录</p> <p>HTTP 401.3 – ACL 禁止访问资源</p> <p>HTTP 401.4 – 未授权：授权被筛选器拒绝</p> <p>HTTP 401.5 – 未授权：ISAPI 或 CGI 授权失败</p> <p>HTTP 403 – 禁止访问</p> <p>HTTP 403 – 对 Internet 服务管理器 的访问仅限于 Localhost</p> <p>HTTP 403.1 禁止访问：禁止可执行访问</p> <p>HTTP 403.2 – 禁止访问：禁止读访问</p> <p>HTTP 403.3 – 禁止访问：禁止写访问</p> <p>HTTP 403.4 – 禁止访问：要求 SSL</p> <p>HTTP 403.5 – 禁止访问：要求 SSL 128</p> <p>HTTP 403.6 – 禁止访问：IP 地址被拒绝</p> <p>HTTP 403.7 – 禁止访问：要求客户证书</p> <p>HTTP 403.8 – 禁止访问：禁止站点访问</p> <p>HTTP 403.9 – 禁止访问：连接的用户过多</p> <p>HTTP 403.10 – 禁止访问：配置无效</p> <p>HTTP 403.11 – 禁止访问：密码更改</p> <p>HTTP 403.12 – 禁止访问：映射器拒绝访问</p> <p>HTTP 403.13 – 禁止访问：客户证书已被吊销</p> <p>HTTP 403.15 – 禁止访问：客户访问许可过多</p> <p>HTTP 403.16 – 禁止访问：客户证书不可信或者无效</p> <p>HTTP 403.17 – 禁止访问：客户证书已经到期或者尚未生效</p> <p>HTTP 404.1 - 无法找到 Web 站点</p> <p>HTTP 404- 无法找到文件</p> <p>HTTP 405 – 资源被禁止</p> <p>HTTP 406 – 无法接受</p> <p>HTTP 407 – 要求代理身份验证</p> <p>HTTP 410 – 永远不可用</p> <p>HTTP 412 – 先决条件失败</p> <p>HTTP 414 – 请求 – URI 太长 HTTP 500 – 内部服务器错误</p> <p>HTTP 500.100 – 内部服务器错误 – ASP 错误</p> <p>HTTP 500-11 服务器关闭</p> <p>HTTP 500-12 应用程序重新启动</p> <p>HTTP 500-13 – 服务器太忙</p> <p>HTTP 500-14 – 应用程序无效</p> <p>HTTP 500-15 – 不允许请求 global.asa</p> <p>Error 501 – 未实现</p> <p>HTTP 502 – 网关错误</p> <ul><li><p>这些状态代码表示临时的响应。客户端在收到常规响应之前，应准备接收一个或多个 1xx 响应。 100 – 继续。
101 – 切换协议。</p> <p>2xx – 成功 这类状态代码表明服务器成功地接受了客户端请求。</p> <p>200 – 确定。客户端请求已成功。</p> <p>201 – 已创建。</p> <p>202 – 已接受。</p> <p>203 – 非权威性信息。</p> <p>204 – 无内容。</p> <p>205 – 重置内容。</p> <p>206 – 部分内容。</p> <p>3xx – 重定向 客户端浏览器必须采取更多操作来实现请求。例如，浏览器可能不得不请求服务器上的不同的页面，或通过代理服务器重复该请求。</p> <p>302 – 对象已移动。</p> <p>304 – 未修改。</p> <p>307 – 临时重定向</p> <p>4xx – 客户端错误</p></li></ul> <h2 id="缓存机制-详细笔记-强缓存-协商缓存"><a href="#缓存机制-详细笔记-强缓存-协商缓存" class="header-anchor">#</a> 缓存机制 详细笔记 强缓存  协商缓存</h2> <h3 id="_5-1-强缓存"><a href="#_5-1-强缓存" class="header-anchor">#</a> 5.1 强缓存</h3> <ul><li><strong>Expires</strong>（HTTP/1.0） ：指定过期日期</li> <li><strong>Cache-Control: max-age</strong>：指定有效期（相对时间）</li></ul> <p>（命中强缓存，浏览器不会向服务器发送请求）</p> <h3 id="_5-2-协商缓存"><a href="#_5-2-协商缓存" class="header-anchor">#</a> 5.2 协商缓存</h3> <ul><li><strong>Last-Modified / If-Modified-Since</strong></li> <li><strong>ETag / If-None-Match</strong></li></ul> <p>（浏览器携带校验信息向服务器询问是否有变更，未变更返回304）</p> <h2 id="jwt"><a href="#jwt" class="header-anchor">#</a> jwt</h2> <h3 id="前端只需要会-5-件事"><a href="#前端只需要会-5-件事" class="header-anchor">#</a> 前端只需要会 5 件事</h3> <table><thead><tr><th style="text-align:left;">#</th> <th style="text-align:left;">任务</th> <th style="text-align:left;">必须知道的 API / 概念</th></tr></thead> <tbody><tr><td style="text-align:left;">1</td> <td style="text-align:left;">登录拿令牌</td> <td style="text-align:left;"><code>fetch/axios.post('/login')</code> 拿到 <code>accessToken</code>、<code>refreshToken</code></td></tr> <tr><td style="text-align:left;">2</td> <td style="text-align:left;">存令牌</td> <td style="text-align:left;"><code>document.cookie = ...</code> 或 <code>localStorage.setItem</code></td></tr> <tr><td style="text-align:left;">3</td> <td style="text-align:left;">发请求带令牌</td> <td style="text-align:left;"><code>axios.defaults.headers.common['Authorization'] = Bearer xxx</code></td></tr> <tr><td style="text-align:left;">4</td> <td style="text-align:left;">令牌过期自动续</td> <td style="text-align:left;">拦截器 401→调用 <code>/refresh</code>→重试原请求</td></tr> <tr><td style="text-align:left;">5</td> <td style="text-align:left;">退出登录</td> <td style="text-align:left;">清令牌 + 调 <code>/logout</code></td></tr></tbody></table> <hr> <h3 id="_20-行骨架代码-可直接用"><a href="#_20-行骨架代码-可直接用" class="header-anchor">#</a> 20 行骨架代码（可直接用）</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">'axios'</span>

<span class="token comment">// ====== 1. 存/取 ======</span>
<span class="token keyword">const</span> <span class="token function-variable function">setTokens</span> <span class="token operator">=</span> <span class="token punctuation">(</span>a<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> r<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  document<span class="token punctuation">.</span>cookie <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">access=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>a<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">; path=/; SameSite=Lax</span><span class="token template-punctuation string">`</span></span>
  document<span class="token punctuation">.</span>cookie <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">refresh=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>r<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">; path=/; SameSite=Lax</span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> <span class="token function-variable function">getCookie</span> <span class="token operator">=</span> <span class="token punctuation">(</span>name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
  document<span class="token punctuation">.</span>cookie<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">(^| )</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">=([^;]*)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">?.</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>

<span class="token comment">// ====== 2. 请求拦截器：自动带令牌 ======</span>
axios<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>request<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>cfg <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  cfg<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string">'Authorization'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Bearer </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">getCookie</span><span class="token punctuation">(</span><span class="token string">'access'</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
  <span class="token keyword">return</span> cfg
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// ====== 3. 响应拦截器：过期自动刷新 ======</span>
<span class="token keyword">let</span> isRefreshing <span class="token operator">=</span> <span class="token boolean">false</span>
axios<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>response<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>
  r <span class="token operator">=&gt;</span> r<span class="token punctuation">,</span>
  <span class="token keyword">async</span> err <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> cfg <span class="token operator">=</span> err<span class="token punctuation">.</span>config
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">.</span>response<span class="token operator">?.</span>status <span class="token operator">===</span> <span class="token number">401</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>cfg<span class="token punctuation">.</span>_retry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      cfg<span class="token punctuation">.</span>_retry <span class="token operator">=</span> <span class="token boolean">true</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isRefreshing<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        isRefreshing <span class="token operator">=</span> <span class="token boolean">true</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> <span class="token punctuation">{</span> data <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> axios<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/auth/refresh'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> refreshToken<span class="token operator">:</span> <span class="token function">getCookie</span><span class="token punctuation">(</span><span class="token string">'refresh'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
          <span class="token function">setTokens</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>accessToken<span class="token punctuation">,</span> data<span class="token punctuation">.</span>refreshToken<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
          isRefreshing <span class="token operator">=</span> <span class="token boolean">false</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> <span class="token function">axios</span><span class="token punctuation">(</span>cfg<span class="token punctuation">)</span> <span class="token comment">// 重发原请求</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token builtin">Promise</span><span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>

<span class="token comment">// ====== 4. 登录 ======</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">login</span><span class="token punctuation">(</span>user<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> pwd<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> data <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> axios<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/auth/login'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> user<span class="token punctuation">,</span> pwd <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token function">setTokens</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>accessToken<span class="token punctuation">,</span> data<span class="token punctuation">.</span>refreshToken<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// ====== 5. 退出 ======</span>
<span class="token keyword">function</span> <span class="token function">logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  axios<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/auth/logout'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> refreshToken<span class="token operator">:</span> <span class="token function">getCookie</span><span class="token punctuation">(</span><span class="token string">'refresh'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  document<span class="token punctuation">.</span>cookie <span class="token operator">=</span> <span class="token string">'access=; path=/; max-age=0'</span>
  document<span class="token punctuation">.</span>cookie <span class="token operator">=</span> <span class="token string">'refresh=; path=/; max-age=0'</span>
<span class="token punctuation">}</span>
</code></pre></div><hr> <h3 id="📦-额外-3-个可选工具包"><a href="#📦-额外-3-个可选工具包" class="header-anchor">#</a> 📦 额外 3 个可选工具包</h3> <ul><li><strong>js-cookie</strong>：<code>Cookies.set('access', token)</code>（防手写正则）</li> <li><strong>jwt-decode</strong>：前端解码 payload，提前判断过期</li> <li><strong>zustand / pinia</strong>：把令牌放全局状态，跨组件共享</li></ul> <hr> <h3 id="🧠-记住-3-个核心口诀"><a href="#🧠-记住-3-个核心口诀" class="header-anchor">#</a> 🧠 记住 3 个核心口诀</h3> <ol><li><strong>登录拿双 token</strong>（access + refresh）</li> <li><strong>cookie 带 SameSite=Lax</strong>（防 CSRF）</li> <li><strong>401 自动刷新</strong>（拦截器里做重试）</li></ol></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/PurpleFish_Blog/assets/js/app.ff8256e3.js" defer></script><script src="/PurpleFish_Blog/assets/js/2.43a24c62.js" defer></script><script src="/PurpleFish_Blog/assets/js/1.6ee28ae7.js" defer></script><script src="/PurpleFish_Blog/assets/js/22.125fbbec.js" defer></script>
  </body>
</html>
