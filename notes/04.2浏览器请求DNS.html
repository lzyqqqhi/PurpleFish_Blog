<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>DNS | PurpleFish’s Blog</title>
    <meta name="generator" content="VuePress 1.9.10">
    
    <meta name="description" content="这是一个基于 VuePress 的博客">
    
    <link rel="preload" href="/PurpleFish_Blog/assets/css/0.styles.2b0a0130.css" as="style"><link rel="preload" href="/PurpleFish_Blog/assets/js/app.ff8256e3.js" as="script"><link rel="preload" href="/PurpleFish_Blog/assets/js/2.43a24c62.js" as="script"><link rel="preload" href="/PurpleFish_Blog/assets/js/1.6ee28ae7.js" as="script"><link rel="preload" href="/PurpleFish_Blog/assets/js/41.7862120c.js" as="script"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/10.b04fc0d4.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/11.5a32c356.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/12.6311bbb4.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/13.9f626855.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/14.2a433a45.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/15.f4a73f35.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/16.0da34392.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/17.4ae81fed.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/18.1198418d.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/19.9efc8374.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/20.5d622c1c.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/21.8daff977.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/22.125fbbec.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/23.51842491.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/24.d29f9239.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/25.50b537e5.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/26.a7803a32.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/27.3a646cab.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/28.0f04383d.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/29.516bbd6e.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/3.a5bdcc19.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/30.0c3e2a58.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/31.c55b1b7b.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/32.6f42b27f.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/33.5630dc9b.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/34.506ccca3.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/35.525f91fc.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/36.3ed31312.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/37.e0c7ab78.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/38.94c28a78.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/39.0f6ab893.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/4.17635ff9.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/40.31380cbc.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/42.e1b28fea.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/43.bba45c93.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/44.f543bcf0.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/45.b3468082.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/46.ce165ee3.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/47.cd346d62.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/48.f34fd7c9.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/49.04a56087.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/5.bb8f33b7.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/50.944cf170.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/51.875167a9.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/52.37cbc86f.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/53.afa7aef4.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/54.f01744cd.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/55.bf004fec.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/56.86541d80.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/57.851b13ff.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/58.9979010b.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/59.80a18be0.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/6.46359932.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/60.3913a449.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/61.95d9a272.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/62.5e28c5de.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/63.23644217.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/64.e291cd20.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/7.720220fb.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/vendors~docsearch.94b65286.js">
    <link rel="stylesheet" href="/PurpleFish_Blog/assets/css/0.styles.2b0a0130.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/PurpleFish_Blog/" class="home-link router-link-active"><!----> <span class="site-name">PurpleFish’s Blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/PurpleFish_Blog/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/PurpleFish_Blog/notes/" class="nav-link router-link-active">
  笔记
</a></div><div class="nav-item"><a href="/PurpleFish_Blog/articles/" class="nav-link">
  文章
</a></div><div class="nav-item"><a href="/PurpleFish_Blog/projects/" class="nav-link">
  项目集
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/PurpleFish_Blog/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/PurpleFish_Blog/notes/" class="nav-link router-link-active">
  笔记
</a></div><div class="nav-item"><a href="/PurpleFish_Blog/articles/" class="nav-link">
  文章
</a></div><div class="nav-item"><a href="/PurpleFish_Blog/projects/" class="nav-link">
  项目集
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>DNS</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/PurpleFish_Blog/notes/04.2%E6%B5%8F%E8%A7%88%E5%99%A8%E8%AF%B7%E6%B1%82DNS.html#dns-解析过程" class="sidebar-link">DNS 解析过程</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/PurpleFish_Blog/notes/04.2%E6%B5%8F%E8%A7%88%E5%99%A8%E8%AF%B7%E6%B1%82DNS.html#dns-解析相关知识" class="sidebar-link">DNS 解析相关知识</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/PurpleFish_Blog/notes/04.2%E6%B5%8F%E8%A7%88%E5%99%A8%E8%AF%B7%E6%B1%82DNS.html#cdn-优先匹配算法策略" class="sidebar-link">CDN 优先匹配算法策略</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/PurpleFish_Blog/notes/04.2%E6%B5%8F%E8%A7%88%E5%99%A8%E8%AF%B7%E6%B1%82DNS.html#前端与-dns-及-cdn-的关联应用" class="sidebar-link">前端与 DNS 及 CDN 的关联应用</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/PurpleFish_Blog/notes/04.2%E6%B5%8F%E8%A7%88%E5%99%A8%E8%AF%B7%E6%B1%82DNS.html#tcp-ip-协议-ip-分配的规则-过程原理" class="sidebar-link">TCP/IP 协议（IP 分配的规则）过程原理</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/PurpleFish_Blog/notes/04.2%E6%B5%8F%E8%A7%88%E5%99%A8%E8%AF%B7%E6%B1%82DNS.html#ip-分配的规则" class="sidebar-link">IP 分配的规则</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="dns"><a href="#dns" class="header-anchor">#</a> DNS</h1> <h2 id="dns-解析过程"><a href="#dns-解析过程" class="header-anchor">#</a> DNS 解析过程</h2> <ol><li><strong>用户发起请求</strong> ：用户在浏览器输入域名，浏览器先查本地缓存，若有对应 IP 地址则直接使用；若没有，向本地 DNS 服务器发起查询请求。</li> <li><strong>本地 DNS 服务器查询</strong> ：本地 DNS 服务器收到请求后，先查自身缓存，若有记录则返回客户端；若没有，作为 DNS 客户端代替用户向根服务器发起递归查询。</li> <li><strong>根域名服务器响应</strong> ：根服务器收到请求，若不知晓最终结果，会告知本地 DNS 服务器应向哪个顶级服务器查询，并返回顶级服务器的地址。</li> <li><strong>顶级域名服务器响应</strong> ：本地 DNS 服务器向顶级服务器发起请求，顶级服务器同样若不能直接解析出 IP 地址，会告知下一级权威域名服务器的地址。</li> <li><strong>权威域名服务器响应</strong> ：本地 DNS 服务器向权威服务器发起请求，权威服务器查询存储的域名和 IP 的映射关系表，将域名对应的 IP 地址等信息连同 TTL 值返回给本地 DNS 服务器。</li> <li><strong>返回结果给用户</strong> ：本地 DNS 服务器将得到的 IP 地址缓存，并将结果返回给用户，用户获得 IP 地址后，即可与对应的主机建立连接。</li></ol> <h2 id="dns-解析相关知识"><a href="#dns-解析相关知识" class="header-anchor">#</a> DNS 解析相关知识</h2> <ul><li><strong>DNS 查询过程</strong> ：当用户在浏览器输入网址时，浏览器会先检查自身缓存是否有该域名对应的 IP 地址记录，若有则直接使用；若没有，会向操作系统发出请求，查询系统缓存。若系统缓存也无该记录，操作系统会查找域名服务器，先查询本地域名服务器，若本地域名服务器无记录，则向根域名服务器查询顶级域名服务器地址，再由根域名服务器返回顶级域名服务器地址，本地域名服务器向顶级域名服务器查询二级域名服务器地址，最后得到域名对应的 IP 地址。</li> <li><strong>DNS 预解析</strong> ：前端可通过在 HTML 中使用<code>&lt;link rel=&quot;dns-prefetch&quot; href=&quot;//example.com&quot;&gt;</code>或设置<code>&lt;meta http-equiv=&quot;x-dns-prefetch-control&quot; content=&quot;on&quot;&gt;</code>来<strong>实现 DNS 预解析</strong>，让浏览器提前解析页面中可能需要访问的域名，减少用户点击链接后的等待时间，提升页面加载速度。</li> <li><strong>减少 DNS 查询次数</strong> ：避免在一个页面中使用过多不同域名的资源请求，因为每次对不同域名的请求都会进行 DNS 查询，会增加页面加载时间。可将外部资源提前下载到同域名的服务器上，或合理规划域名的使用。</li></ul> <h2 id="cdn-优先匹配算法策略"><a href="#cdn-优先匹配算法策略" class="header-anchor">#</a> CDN 优先匹配算法策略</h2> <ul><li><strong>基于地理位置的匹配</strong> ：通过用户的 IP 地址识别其地理位置，然后将用户的请求定向到<strong>距离其最近的 CDN 节点</strong>。这样可以减少数据传输的距离和延迟，提高访问速度。例如，一个中国上海的用户访问网站时，DNS 服务器会将其请求解析到位于上海或离上海最近的 CDN 节点。</li> <li><strong>基于网络状况的匹配</strong> ：根据用户当前网络的带宽、延迟和丢包率等信息，为用户选择最佳服务器。比如，当用户在网络状况不佳时，CDN 系统会将其请求分配到网络质量相对较好的节点，以确保用户能够获得较好的访问体验。</li> <li><strong>基于设备类型的匹配</strong> ：不同设备通常有不同的网络条件和展示需求。智能 DNS 会根据用户使用的设备，如手机、PC 或平板等，<strong>智能地调整所请求的内容</strong>。例如，对于移动设备，可能会提供压缩过的图像或简化版的页面，以优化用户的访问体验。</li> <li><strong>基于内容分发协议的匹配</strong> ：不同的 CDN 提供商可能使用不同的内容分发协议和算法，这些协议和算法会影响资源的分发效率和访问速度。一些先进的 CDN 技术，如 Anycast 路由协议，可以将用户的请求智能地分配到最优的服务器节点，实现快速稳定的内容分发。</li> <li><strong>缓存规则匹配</strong> ：CDN 会根据预先设定<strong>的缓存规则</strong>来匹配和处理用户的请求。缓存规则可以基于文件后缀、目录路径或文件全路径等条件进行设置，并且规则具有优先级，数字 1 的规则优先级最高。当用户的请求与缓存规则匹配时，CDN 会优先返回缓存中的资源，减少对源站的访问，提高资源的加载速度。</li> <li>在有 CDN 的情况下，CDN 的优先匹配算法策略会在 DNS 解析过程中发挥作用：
<ul><li><strong>全球负载均衡（GSLB）</strong> ：通过 GSLB 设备，根据用户本地 DNS 的 IP 地址等信息，将用户优先分配到距离最近或最适合的 CDN 节点。例如，可基于地理区域或用户自定义区域进行划分，将特定 IP 范围的用户优先分配到某个通过健康检查的站点。</li> <li><strong>RTT（往返时间）策略</strong> ：选择 RTT 值最小的站点的 VIP 返回给 LDNS，以此来选择最适合用户的 CDN 节点。其中，Passive RTT 测量更实用，它从用户向返回的 VIP 建立连接时进行采集，不会主动测量，也不会产生额外的数据流量。</li> <li><strong>IP 地址权重</strong> ：为 DNS 应答中的<strong>每个 IP 地址分配权重</strong>，权重决定与其他候选 IP 相比分配到该 IP 的流量比例，从而合理地将用户请求分配到不同的 CDN 节点。</li></ul></li></ul> <h2 id="前端与-dns-及-cdn-的关联应用"><a href="#前端与-dns-及-cdn-的关联应用" class="header-anchor">#</a> 前端与 DNS 及 CDN 的关联应用</h2> <ul><li><strong>域名配置与解析</strong> ：前端开发中，需要<strong>确保网站的域名正确配置了 CDN 的 CNAME 地址</strong>，以便用户通过域名访问时能够正确解析到 CDN 节点。同时，合理设置域名的 <strong>TTL（Time to Live）值，平衡 DNS 缓存时间和更新及时性</strong>。</li> <li><strong>资源加载优化</strong> ：借助 CDN 的优势，前端应<strong>尽量将网站的静态资源（如图片、CSS、JavaScript 文件等）托管到 CDN 上</strong>，并通过域名映射的方式进行加载。在代码中引用这些资源时，使用 CDN 的域名，确保用户能够快速获取资源。此外，还可以结合资源的版本号或缓存控制策略，避免因缓存问题导致用户无法获取到最新的资源。</li> <li><strong>性能监测与分析</strong> ：前端可以通过性能监测工具，如浏览器的开发者工具、第三方性能监测服务等，分析 DNS 解析时间和资源加载时间等指标，评估 DNS 及 CDN 的性能表现。根据监测结果，发现问题并进行优化，例如调整缓存策略、更换 CDN 服务商或优化资源的分布等。</li></ul> <h4 id="注意事项"><a href="#注意事项" class="header-anchor">#</a> 注意事项</h4> <ul><li><strong>CDN 缓存更新问题</strong> ：由于 CDN 节点有缓存机制，当源站的内容更新后，CDN 节点上的缓存可能不会立即更新，导致用户访问到的不是最新的内容。可以通过设置合理的缓存过期时间、主动刷新缓存或使用版本号等方式来解决这个问题。</li> <li><strong>故障转移机制</strong> ：了解 CDN 的故障转移机制，在某些 CDN 节点出现故障时，DNS 能够自动将用户的请求切换到其他可用的节点，确保服务的高可用性。前端开发中可以关注 CDN 服务商提供的故障转移配置和相关文档，以便在需要时进行调整和优化。</li></ul> <h2 id="tcp-ip-协议-ip-分配的规则-过程原理"><a href="#tcp-ip-协议-ip-分配的规则-过程原理" class="header-anchor">#</a> TCP/IP 协议（IP 分配的规则）过程原理</h2> <ol><li><strong>确定目标 IP 地址与端口号</strong> ：通过 DNS 解析得到目标服务器的 IP 地址后，还需确定通信所使用的端口号。不同的服务通常使用特定的端口号，如 HTTP 协议默认使用 80 端口，HTTPS 协议默认使用 443 端口等。</li> <li><strong>网络接口选择与 IP 寻址</strong> ：本地设备需确定通过哪个网络接口发送数据。操作系统根据路由表选择最佳的网络接口，并确定数据包的源 IP 地址。若本地设备与目标服务器处于同一个网络，数据包直接发送到目标服务器；若处于不同网络，数据包发送到本地网络的默认网关，由网关负责转发。</li> <li><strong>建立 TCP 连接（三次握手）</strong> ：客户端向服务器发送一个 SYN 报文段，随机选择初始序列号；服务器收到后，发送一个 ACK 报文段，同时将 SYN 位置为 1，并携带自己的初始序列号；客户端收到服务器的 SYN+ACK 报文段后，向服务器发送一个 ACK 报文段，确认号为服务器 SEQ 加 1，至此 TCP 连接建立完成。</li> <li><strong>发送数据报文</strong> ：TCP 连接建立后，客户端通过该连接，将用户请求的数据封装到 TCP 报文段的数据部分，通过 IP 协议传输到服务器。服务器接收到数据后进行处理，并将响应数据封装到 TCP 报文段的数据部分，通过 IP 协议发送回客户端。</li> <li><strong>数据传输过程中的 IP 寻址与路由</strong> ：在整个数据传输过程中，数据以 IP 数据报的形式在网络中传输，每个 IP 数据报都包含源 IP 地址和目标 IP 地址。网络中的路由器根据目标 IP 地址和自身的路由表，确定数据报的转发路径，直到数据报到达目标服务器或客户端。</li> <li><strong>关闭 TCP 连接（四次挥手）</strong> ：客户端发送一个 FIN 报文段给服务器，表示无数据发送；服务器收到后，发送一个 ACK 报文段给客户端；服务器完成数据发送后，发送一个 FIN 报文段给客户端；客户端收到后，发送一个 ACK 报文段给服务器，确认收到关闭请求，至此 TCP 连接关闭。</li></ol> <h2 id="ip-分配的规则"><a href="#ip-分配的规则" class="header-anchor">#</a> IP 分配的规则</h2> <ol><li><strong>IPv4 地址分配</strong> ：通常由互联网服务提供商（ISP）从互联网注册管理机构（IR）申请获得一定范围的公有 IP 地址，并将这些地址分配给用户。私有 IP 地址由网络管理员在内部网络中手动或自动分配，通过 NAT 技术将私有 IP 地址映射为公有 IP 地址，实现内部网络设备与外部互联网的通信。IPv4 地址分为 A、B、C、D、E 五类，A、B、C 类地址用于不同规模的网络，D 类地址用于多播通信，E 类地址保留用于科研实验。</li> <li><strong>IPv6 地址分配</strong> ：IPv6 地址有全局单播地址、链路本地地址、唯一本地地址、多播地址、任播地址等多种类型。其中，全局单播地址用于全球范围的唯一标识，链路本地地址自动配置且仅在本地链路内有效，唯一本地地址用于私有网络。</li></ol></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/PurpleFish_Blog/assets/js/app.ff8256e3.js" defer></script><script src="/PurpleFish_Blog/assets/js/2.43a24c62.js" defer></script><script src="/PurpleFish_Blog/assets/js/1.6ee28ae7.js" defer></script><script src="/PurpleFish_Blog/assets/js/41.7862120c.js" defer></script>
  </body>
</html>
