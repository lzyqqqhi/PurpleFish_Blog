<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Vue框架（CSR-SSR） | PurpleFish’s Blog</title>
    <meta name="generator" content="VuePress 1.9.10">
    
    <meta name="description" content="这是一个基于 VuePress 的博客">
    
    <link rel="preload" href="/PurpleFish_Blog/assets/css/0.styles.2b0a0130.css" as="style"><link rel="preload" href="/PurpleFish_Blog/assets/js/app.ff8256e3.js" as="script"><link rel="preload" href="/PurpleFish_Blog/assets/js/2.43a24c62.js" as="script"><link rel="preload" href="/PurpleFish_Blog/assets/js/1.6ee28ae7.js" as="script"><link rel="preload" href="/PurpleFish_Blog/assets/js/61.95d9a272.js" as="script"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/10.b04fc0d4.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/11.5a32c356.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/12.6311bbb4.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/13.9f626855.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/14.2a433a45.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/15.f4a73f35.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/16.0da34392.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/17.4ae81fed.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/18.1198418d.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/19.9efc8374.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/20.5d622c1c.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/21.8daff977.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/22.125fbbec.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/23.51842491.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/24.d29f9239.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/25.50b537e5.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/26.a7803a32.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/27.3a646cab.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/28.0f04383d.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/29.516bbd6e.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/3.a5bdcc19.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/30.0c3e2a58.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/31.c55b1b7b.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/32.6f42b27f.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/33.5630dc9b.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/34.506ccca3.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/35.525f91fc.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/36.3ed31312.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/37.e0c7ab78.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/38.94c28a78.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/39.0f6ab893.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/4.17635ff9.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/40.31380cbc.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/41.7862120c.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/42.e1b28fea.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/43.bba45c93.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/44.f543bcf0.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/45.b3468082.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/46.ce165ee3.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/47.cd346d62.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/48.f34fd7c9.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/49.04a56087.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/5.bb8f33b7.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/50.944cf170.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/51.875167a9.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/52.37cbc86f.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/53.afa7aef4.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/54.f01744cd.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/55.bf004fec.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/56.86541d80.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/57.851b13ff.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/58.9979010b.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/59.80a18be0.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/6.46359932.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/60.3913a449.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/62.5e28c5de.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/63.23644217.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/64.e291cd20.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/7.720220fb.js"><link rel="prefetch" href="/PurpleFish_Blog/assets/js/vendors~docsearch.94b65286.js">
    <link rel="stylesheet" href="/PurpleFish_Blog/assets/css/0.styles.2b0a0130.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/PurpleFish_Blog/" class="home-link router-link-active"><!----> <span class="site-name">PurpleFish’s Blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/PurpleFish_Blog/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/PurpleFish_Blog/notes/" class="nav-link router-link-active">
  笔记
</a></div><div class="nav-item"><a href="/PurpleFish_Blog/articles/" class="nav-link">
  文章
</a></div><div class="nav-item"><a href="/PurpleFish_Blog/projects/" class="nav-link">
  项目集
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/PurpleFish_Blog/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/PurpleFish_Blog/notes/" class="nav-link router-link-active">
  笔记
</a></div><div class="nav-item"><a href="/PurpleFish_Blog/articles/" class="nav-link">
  文章
</a></div><div class="nav-item"><a href="/PurpleFish_Blog/projects/" class="nav-link">
  项目集
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Vue框架（CSR-SSR）</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/PurpleFish_Blog/notes/08.1vue.html#vue2高级用法" class="sidebar-link">Vue2高级用法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/PurpleFish_Blog/notes/08.1vue.html#mini" class="sidebar-link">mini</a></li></ul></li><li><a href="/PurpleFish_Blog/notes/08.1vue.html#vue-插槽-slot-使用与原理" class="sidebar-link">Vue 插槽（Slot）使用与原理</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/PurpleFish_Blog/notes/08.1vue.html#vue3新特性" class="sidebar-link">Vue3新特性</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/PurpleFish_Blog/notes/08.1vue.html#生命周期" class="sidebar-link">生命周期</a></li><li class="sidebar-sub-header"><a href="/PurpleFish_Blog/notes/08.1vue.html#proxy-重写响应式" class="sidebar-link">Proxy 重写响应式</a></li><li class="sidebar-sub-header"><a href="/PurpleFish_Blog/notes/08.1vue.html#全新编译器" class="sidebar-link">全新编译器</a></li><li class="sidebar-sub-header"><a href="/PurpleFish_Blog/notes/08.1vue.html#tree-shaking-友好" class="sidebar-link">Tree-Shaking 友好</a></li><li class="sidebar-sub-header"><a href="/PurpleFish_Blog/notes/08.1vue.html#运行时体积瘦身" class="sidebar-link">运行时体积瘦身</a></li><li class="sidebar-sub-header"><a href="/PurpleFish_Blog/notes/08.1vue.html#全面支持ts" class="sidebar-link">全面支持TS</a></li><li class="sidebar-sub-header"><a href="/PurpleFish_Blog/notes/08.1vue.html#新的响应式系统-proxy-实现" class="sidebar-link">新的响应式系统（Proxy 实现）</a></li><li class="sidebar-sub-header"><a href="/PurpleFish_Blog/notes/08.1vue.html#setup语法糖" class="sidebar-link">setup语法糖</a></li><li class="sidebar-sub-header"><a href="/PurpleFish_Blog/notes/08.1vue.html#teleport-传送门" class="sidebar-link">Teleport 传送门</a></li><li class="sidebar-sub-header"><a href="/PurpleFish_Blog/notes/08.1vue.html#fragment" class="sidebar-link">Fragment</a></li></ul></li><li><a href="/PurpleFish_Blog/notes/08.1vue.html#suspense-异步组件-懒加载" class="sidebar-link">Suspense（异步组件/懒加载）</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/PurpleFish_Blog/notes/08.1vue.html#动态异步组件" class="sidebar-link">动态异步组件</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/PurpleFish_Blog/notes/08.1vue.html#全局api" class="sidebar-link">全局API</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/PurpleFish_Blog/notes/08.1vue.html#emits显示声明" class="sidebar-link">emits显示声明</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/PurpleFish_Blog/notes/08.1vue.html#v-model与多值绑定-vue-3-4-新特性" class="sidebar-link">V-model与多值绑定（Vue 3.4+ 新特性）</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/PurpleFish_Blog/notes/08.1vue.html#vuex-vs-pinia" class="sidebar-link">Vuex vs Pinia</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/PurpleFish_Blog/notes/08.1vue.html#vuex-最小模板-vue3-ts" class="sidebar-link">Vuex 最小模板（Vue3 + TS）</a></li><li class="sidebar-sub-header"><a href="/PurpleFish_Blog/notes/08.1vue.html#pinia-最小模板-vue3-ts" class="sidebar-link">Pinia 最小模板（Vue3 + TS）</a></li><li class="sidebar-sub-header"><a href="/PurpleFish_Blog/notes/08.1vue.html#速记口诀" class="sidebar-link">速记口诀</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="vue框架-csr-ssr"><a href="#vue框架-csr-ssr" class="header-anchor">#</a> Vue框架（CSR-SSR）</h1> <h2 id="vue2高级用法"><a href="#vue2高级用法" class="header-anchor">#</a> Vue2高级用法</h2> <h3 id="mini"><a href="#mini" class="header-anchor">#</a> mini</h3> <ul><li>“把多个组件都要用的 data / methods / 生命周期等公共配置抽成一个 JS 对象，通过 <code>mixins: [xxx]</code> 混入到组件中，实现代码复用。”</li> <li>“mixin 是 Vue2 的代码复用利器，可以混入任何组件选项，遵循数据冲突组件优先、钩子合并顺序执行的规则，适合抽离公共逻辑，但应避免全局滥用。”</li></ul> <h5 id="使用示例"><a href="#使用示例" class="header-anchor">#</a> 使用示例</h5> <ol><li>定义</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// common/mixin.js</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> logMixin <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">data</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">logs</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'mixin created'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token function">log</span><span class="token punctuation">(</span><span class="token parameter">msg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>logs<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="2"><li>局部混入</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Child'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">mixins</span><span class="token operator">:</span> <span class="token punctuation">[</span>logMixin<span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment">// 数组</span>
  <span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'child created'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="3"><li>全局混入</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span>
Vue<span class="token punctuation">.</span><span class="token function">mixin</span><span class="token punctuation">(</span>logMixin<span class="token punctuation">)</span>   <span class="token comment">// 所有组件都会拥有</span>
</code></pre></div><h5 id="选项合并规则"><a href="#选项合并规则" class="header-anchor">#</a> 选项合并规则</h5> <table><thead><tr><th style="text-align:left;">选项类型</th> <th style="text-align:left;">冲突时优先级</th> <th style="text-align:left;">执行顺序/结果示例</th></tr></thead> <tbody><tr><td style="text-align:left;">data</td> <td style="text-align:left;">组件自身优先</td> <td style="text-align:left;"><code>{ ...mixinData, ...componentData }</code></td></tr> <tr><td style="text-align:left;">methods / computed / props / inject / directives</td> <td style="text-align:left;">组件自身覆盖 mixin</td> <td style="text-align:left;"><code>component.fn()</code> 会覆盖同名 mixin.fn</td></tr> <tr><td style="text-align:left;">生命周期钩子</td> <td style="text-align:left;">合并成数组，全部执行</td> <td style="text-align:left;">mixin → 组件（顺序固定）</td></tr> <tr><td style="text-align:left;">watch / provide 等对象选项</td> <td style="text-align:left;">同 methods 规则合并</td> <td style="text-align:left;">冲突字段以组件为准</td></tr></tbody></table> <h5 id="问题"><a href="#问题" class="header-anchor">#</a> 问题：</h5> <ul><li>命名冲突，同名选项被覆盖，追踪困难；</li> <li>依赖透明，混入来源不透明，难以一眼看出组件依赖了哪些外部逻辑。</li></ul> <h2 id="vue-插槽-slot-使用与原理"><a href="#vue-插槽-slot-使用与原理" class="header-anchor">#</a> Vue 插槽（Slot）使用与原理</h2> <ul><li>“插槽是 <strong>父组件向子组件注入任意模板片段</strong> 的通道；作用域插槽还能把子组件数据反向暴露给父组件。”</li></ul> <h4 id="分类总览"><a href="#分类总览" class="header-anchor">#</a> 分类总览</h4> <ol><li><strong>默认插槽</strong>（无 name）</li> <li><strong>具名插槽</strong>（name=&quot;xxx&quot;）</li> <li><strong>作用域插槽</strong>（slot props 反向传值）</li> <li><strong>动态插槽名</strong>（<code>[slotName]</code>）</li> <li><strong>Vue3 简化语法</strong>（<code>#header</code> 代替 <code>v-slot:header</code>）</li></ol> <h4 id="语法对比-vue2-vs-vue3"><a href="#语法对比-vue2-vs-vue3" class="header-anchor">#</a> 语法对比（Vue2 vs Vue3）</h4> <table><thead><tr><th style="text-align:left;">特性</th> <th style="text-align:left;">Vue2</th> <th style="text-align:left;">Vue3</th></tr></thead> <tbody><tr><td style="text-align:left;">默认插槽</td> <td style="text-align:left;"><code>&lt;slot&gt;&lt;/slot&gt;</code></td> <td style="text-align:left;"><code>&lt;slot /&gt;</code></td></tr> <tr><td style="text-align:left;">具名插槽</td> <td style="text-align:left;"><code>&lt;slot name=&quot;h&quot;&gt;&lt;/slot&gt;</code></td> <td style="text-align:left;"><code>&lt;slot name=&quot;h&quot; /&gt;</code></td></tr> <tr><td style="text-align:left;">作用域插槽</td> <td style="text-align:left;"><code>&lt;slot :item=&quot;item&quot;&gt;&lt;/slot&gt;</code></td> <td style="text-align:left;"><code>&lt;slot :item=&quot;item&quot; /&gt;</code></td></tr> <tr><td style="text-align:left;">父组件写法</td> <td style="text-align:left;"><code>&lt;template slot=&quot;h&quot; slot-scope=&quot;{item}&quot;&gt;</code></td> <td style="text-align:left;"><code>&lt;template #h=&quot;{item}&quot;&gt;</code></td></tr> <tr><td style="text-align:left;">动态插槽名</td> <td style="text-align:left;">不支持</td> <td style="text-align:left;"><code>&lt;template #[slotName]&gt;</code></td></tr></tbody></table> <h4 id="作用域插槽典型模式"><a href="#作用域插槽典型模式" class="header-anchor">#</a> 作用域插槽典型模式</h4> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token comment">&lt;!-- 子组件：数据由子组件产生 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span> <span class="token attr-name">:user</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>user<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:index</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>i<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>slot</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!-- 父组件：拿到子组件数据再渲染 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Child</span> <span class="token attr-name">#default</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{user,index}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">&gt;</span></span>{{ index }} - {{ user.name }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Child</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h4 id="原理"><a href="#原理" class="header-anchor">#</a> 原理</h4> <ul><li><p>Vue 编译阶段把父组件写在子组件标签内的模板片段转换成 <strong>VNode 或函数</strong>，子组件遇到 <code>&lt;slot&gt;</code> 占位符时，用这些 VNode/函数替换占位；</p></li> <li><p>作用域插槽额外把子组件数据以函数参数形式回传，使父组件可在渲染时解构使用，实现 <strong>模板与数据双向解耦</strong>。</p></li></ul> <h2 id="vue3新特性"><a href="#vue3新特性" class="header-anchor">#</a> Vue3新特性</h2> <h3 id="生命周期"><a href="#生命周期" class="header-anchor">#</a> 生命周期</h3> <table><thead><tr><th>阶段</th> <th>Vue2（Options API）</th> <th>Vue3（Composition API）</th> <th>备注</th></tr></thead> <tbody><tr><td>创建前</td> <td><code>beforeCreate</code></td> <td>❌（<code>setup()</code> 执行时即相当于 beforeCreate &amp; created）</td> <td>Vue3 无直接对应，逻辑直接写在 <code>setup()</code></td></tr> <tr><td>创建后</td> <td><code>created</code></td> <td>❌（同上）</td> <td>同上</td></tr> <tr><td>挂载前</td> <td><code>beforeMount</code></td> <td><code>onBeforeMount</code></td> <td>时间点一致</td></tr> <tr><td>挂载后</td> <td><code>mounted</code></td> <td><code>onMounted</code></td> <td>时间点一致</td></tr> <tr><td>更新前</td> <td><code>beforeUpdate</code></td> <td><code>onBeforeUpdate</code></td> <td>时间点一致</td></tr> <tr><td>更新后</td> <td><code>updated</code></td> <td><code>onUpdated</code></td> <td>时间点一致</td></tr> <tr><td>卸载前</td> <td><code>beforeDestroy</code></td> <td><code>onBeforeUnmount</code></td> <td><strong>仅改名</strong></td></tr> <tr><td>卸载后</td> <td><code>destroyed</code></td> <td><code>onUnmounted</code></td> <td><strong>仅改名</strong></td></tr> <tr><td>激活/停用</td> <td><code>activated</code> / <code>deactivated</code></td> <td><code>onActivated</code> / <code>onDeactivated</code></td> <td>仅 KeepAlive 有效</td></tr> <tr><td>错误捕获</td> <td><code>errorCaptured</code></td> <td><code>onErrorCaptured</code></td> <td>时间点一致</td></tr></tbody></table> <h5 id="composition-api-组合式-api"><a href="#composition-api-组合式-api" class="header-anchor">#</a> Composition API（组合式 API）</h5> <ul><li>新的响应式开发模式，相较于传统 Options API 更灵活、强解耦、便于逻辑复用</li> <li>核心 API：setup、ref、reactive、computed、watch、provide/inject、custom hooks</li></ul> <h3 id="proxy-重写响应式"><a href="#proxy-重写响应式" class="header-anchor">#</a> Proxy 重写响应式</h3> <ul><li>砍掉 Vue2 的 Object.defineProperty 递归劫持，数组/深层对象一次性劫持，依赖追踪 O(1)。</li></ul> <h3 id="全新编译器"><a href="#全新编译器" class="header-anchor">#</a> 全新编译器</h3> <ul><li>模板编译时给<strong>静态节点</strong>打<strong>PatchFlag</strong> → diff 时直接跳过，只做「动态节点」的最小比对；静态树整体提升(hoist)。</li></ul> <h3 id="tree-shaking-友好"><a href="#tree-shaking-友好" class="header-anchor">#</a> Tree-Shaking 友好</h3> <ul><li>所有 API 以 ES Module 导出，未引用的功能（如 v-model、transition）在打包时被 <strong>Rollup/Webpack</strong> 摇掉，<strong>基线体积仅 ~10 KB(gzip)</strong>。</li></ul> <h3 id="运行时体积瘦身"><a href="#运行时体积瘦身" class="header-anchor">#</a> 运行时体积瘦身</h3> <ul><li>核心包拆分 <code>@vue/runtime-core</code> + <code>@vue/runtime-dom</code>，可按平台裁剪。</li> <li>支持 <strong>服务端渲染（SSR）下客户端激活仅 6 KB(gzip)</strong>，全新的 <code>@vue/server-renderer</code> 包，API 更简洁</li></ul> <h3 id="全面支持ts"><a href="#全面支持ts" class="header-anchor">#</a> 全面支持TS</h3> <ol><li><p><strong>源码即 TS</strong>
整个 Vue3 核心用 TS 重写，所有 API 自带完整类型定义（<code>.d.ts</code>），无需额外 <code>@types/vue</code>。</p></li> <li><p><strong>推断更精准</strong>
• <code>reactive/ref</code> 自动推断深层类型；
• <code>props/emits</code> 在 <code>&lt;script setup&gt;</code> 里直接写 TS 接口，模板里立即有类型提示。</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">interface</span> <span class="token class-name">Props</span> <span class="token punctuation">{</span> modelValue<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">}</span>
<span class="token keyword">const</span> props <span class="token operator">=</span> <span class="token generic-function"><span class="token function">defineProps</span><span class="token generic class-name"><span class="token operator">&lt;</span>Props<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p><strong>生命周期 &amp; 上下文全约束</strong> <code>onMounted</code>、<code>onUpdated</code> 等钩子参数和返回值都有严格类型；<code>useRouter()</code>、<code>useRoute()</code> 返回的路由对象也全类型化。</p></li> <li><p><strong>模板内类型检查</strong>
Volar 插件支持在 <code>.vue</code> 模板里对 props、事件、ref 进行实时类型校验，开发阶段即可捕获错误。</p></li></ol> <h3 id="新的响应式系统-proxy-实现"><a href="#新的响应式系统-proxy-实现" class="header-anchor">#</a> 新的响应式系统（Proxy 实现）</h3> <ol><li><p>底层替换</p> <ul><li><p>Vue2：Object.defineProperty <strong>递归劫持属性</strong>，新增/删除属性需 Vue.set/delete。</p></li> <li><p>Vue3：ES6 Proxy <strong>整体代理对象</strong>，一次性劫持所有属性及新增、删除、数组索引。</p></li></ul></li> <li><p>数据类型全覆盖</p> <ul><li><p>对象、数组、Map、Set、WeakMap、嵌套结构全部天然响应式。</p></li> <li><p>数组 <code>push/pop/splice</code> 不再触发 hack，直接走原生方法。</p></li></ul></li> <li><p>性能 &amp; Bug 修复</p> <ul><li><p>初始化时只做 <strong>一层代理</strong>，深层按需懒代理，内存占用↓。</p></li> <li><p>避免 Vue2 的 <strong>数组下标监听遗漏</strong>、<strong>对象新增属性不响应</strong> 等经典坑。</p></li> <li><p>依赖收集 <strong>O(1) 哈希表</strong>，触发更新更快。</p></li></ul></li> <li><p>关键 API</p> <ul><li><p><code>reactive(obj)</code>：深层响应式代理。</p></li> <li><p><code>ref(val)</code>：包装基本类型，<code>.value</code> 访问。</p></li> <li><p><code>readonly(obj)</code> / <code>shallowReactive(obj)</code>：只读或浅层代理。</p></li> <li><p><code>toRaw(proxy)</code>：拿到原始对象。</p></li></ul></li></ol> <h3 id="setup语法糖"><a href="#setup语法糖" class="header-anchor">#</a> setup语法糖</h3> <ul><li>顶层变量、函数<strong>自动暴露</strong>到模板，无需 <code>return</code>。</li> <li><code>defineProps&lt;Props&gt;() / defineEmits&lt;Emits&gt;()</code> 直接写 TS 接口，类型推断一步到位。</li></ul> <h3 id="teleport-传送门"><a href="#teleport-传送门" class="header-anchor">#</a> Teleport 传送门</h3> <ul><li>把组件内的模板片段“瞬移”到任意 DOM 节点（body、某个 ref、甚至 Shadow DOM），保留组件作用域 &amp; 响应式。</li></ul> <h5 id="需求场景"><a href="#需求场景" class="header-anchor">#</a> 需求场景</h5> <table><thead><tr><th>需求场景</th> <th>Teleport</th> <th>普通写法（不 teleport）</th> <th>实际痛点</th> <th>作用一句话</th></tr></thead> <tbody><tr><td><strong>全局弹窗/遮罩</strong></td> <td><code>&lt;Teleport to=&quot;body&quot;&gt;</code></td> <td>弹窗节点嵌套在父组件 DOM 里</td> <td>父级 <code>overflow:hidden</code>、<code>z-index</code> 层级被限制，弹窗被裁剪或盖住</td> <td><strong>瞬间把弹窗提到 body 顶层，100% 不被裁剪</strong></td></tr> <tr><td><strong>抽屉/侧边栏</strong></td> <td><code>&lt;Teleport to=&quot;#sidebar&quot;&gt;</code></td> <td>抽屉节点在业务组件内部</td> <td>业务组件内部滚动条、布局影响抽屉定位</td> <td><strong>把抽屉移到专用容器，布局隔离，代码零侵入</strong></td></tr> <tr><td><strong>表单校验提示</strong></td> <td><code>&lt;Teleport to=&quot;label&quot;&gt;</code></td> <td>提示节点跟在 input 旁</td> <td>提示被 <code>position:relative</code> 父级截断</td> <td><strong>提示框直接挂在 label 旁，不破坏布局层级</strong></td></tr> <tr><td><strong>富文本编辑器工具栏</strong></td> <td><code>&lt;Teleport to=&quot;#toolbar&quot;&gt;</code></td> <td>工具栏嵌套在编辑器内部</td> <td>编辑器内部滚动导致工具栏错位</td> <td><strong>工具栏固定到页面顶部，滚动不抖动</strong></td></tr> <tr><td><strong>SSR 水合(hydrate)</strong></td> <td><code>&lt;Teleport to=&quot;#portal&quot;&gt;</code></td> <td>服务端渲染后客户端节点位置不匹配</td> <td>水合失败或闪烁</td> <td><strong>SSR 时把节点渲染到目标容器，客户端直接复用，避免闪烁</strong></td></tr></tbody></table> <h3 id="fragment"><a href="#fragment" class="header-anchor">#</a> Fragment</h3> <ul><li>组件 / 模板可以直接返回多个根节点，Vue 3 会自动包成 Fragment，无需额外 <div> 或  包裹。</div></li></ul> <table><thead><tr><th>要点</th> <th>说明</th></tr></thead> <tbody><tr><td><strong>v-if / v-for</strong></td> <td>同样适用，多根节点照常写</td></tr> <tr><td><strong>key</strong></td> <td>每个根节点都可独立 <code>:key</code></td></tr> <tr><td><strong>CSS</strong></td> <td>选中多根节点需用 <code>:scope</code> 或父级包裹器</td></tr> <tr><td><strong>TSX / JSX</strong></td> <td>直接 <code>return [h1, p, button]</code> 即可</td></tr> <tr><td><strong>过渡 <code>&lt;Transition&gt;</code></strong></td> <td>多根需包 <code>&lt;TransitionGroup&gt;</code> 或手动加 key</td></tr></tbody></table> <h2 id="suspense-异步组件-懒加载"><a href="#suspense-异步组件-懒加载" class="header-anchor">#</a> Suspense（异步组件/懒加载）</h2> <ul><li><p>Vue3 内建“等待室”，自动挂起异步组件 / async setup，加载中渲染 fallback，完成后无缝切换主内容，天然支持懒加载与错误边界。</p></li> <li><p>代码</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Suspense</span>
    <span class="token attr-name">@pending</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>() =&gt; console.log('开始加载')<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name">@resolve</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>() =&gt; console.log('加载完成')<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name">@fallback</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>(err) =&gt; console.error('加载失败', err)<span class="token punctuation">&quot;</span></span>
  <span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>AsyncComp</span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">#fallback</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>Loading…<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Suspense</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span> defineAsyncComponent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> Loading <span class="token keyword">from</span> <span class="token string">'./Loading.vue'</span>
<span class="token keyword">import</span> Error <span class="token keyword">from</span> <span class="token string">'./Error.vue'</span>

<span class="token keyword">const</span> AsyncComp <span class="token operator">=</span> <span class="token function">defineAsyncComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function-variable function">loader</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./MyComp.vue'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token literal-property property">delay</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>                 <span class="token comment">// 立即显示 loading</span>
  <span class="token literal-property property">timeout</span><span class="token operator">:</span> <span class="token number">3000</span><span class="token punctuation">,</span>            <span class="token comment">// 3 秒超时</span>
  <span class="token literal-property property">loadingComponent</span><span class="token operator">:</span> Loading<span class="token punctuation">,</span>
  <span class="token literal-property property">errorComponent</span><span class="token operator">:</span> Error
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h5 id="组合套路"><a href="#组合套路" class="header-anchor">#</a> 组合套路</h5> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>RouterView</span> <span class="token attr-name">v-slot</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{ Component }<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Transition</span> <span class="token attr-name">mode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>out-in<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>KeepAlive</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Suspense</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>component</span> <span class="token attr-name">:is</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Component<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">#fallback</span><span class="token punctuation">&gt;</span></span>正在加载…<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Suspense</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>KeepAlive</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Transition</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>RouterView</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="动态异步组件"><a href="#动态异步组件" class="header-anchor">#</a> 动态异步组件</h2> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- 1. 条件渲染 --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>isLoad<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 2. 动态异步组件 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>component</span>
      <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>key in arr<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>key<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">:is</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>asyncComps[key]<span class="token punctuation">&quot;</span></span>
    <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span> ref<span class="token punctuation">,</span> shallowRef <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>

<span class="token comment">// 3. 数据</span>
<span class="token keyword">const</span> arr   <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>
<span class="token keyword">const</span> isLoad <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>

<span class="token comment">// 4. 批量生成异步组件</span>
<span class="token keyword">const</span> asyncComps <span class="token operator">=</span> arr<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">acc<span class="token punctuation">,</span> key</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  acc<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">shallowRef</span><span class="token punctuation">(</span>
    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">./Comp</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.vue</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>   <span class="token comment">// 动态 import</span>
  <span class="token punctuation">)</span>
  <span class="token keyword">return</span> acc
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 5. 手动触发加载（可换成 onMounted）</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>isLoad<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="全局api"><a href="#全局api" class="header-anchor">#</a> 全局API</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// main.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createApp <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">'./App.vue'</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">createApp</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span>

<span class="token comment">// 新的全局挂载、配置全部在 app 上</span>
app<span class="token punctuation">.</span>config<span class="token punctuation">.</span>globalProperties<span class="token punctuation">.</span><span class="token function-variable function">$http</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
app<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span><span class="token string">'Foo'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">directive</span><span class="token punctuation">(</span><span class="token string">'focus'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">mount</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span>
</code></pre></div></li></ul> <h2 id="emits显示声明"><a href="#emits显示声明" class="header-anchor">#</a> emits显示声明</h2> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ts<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token comment">// 1. 声明事件名称</span>
<span class="token keyword">const</span> emit <span class="token operator">=</span> defineEmits<span class="token operator">&lt;</span><span class="token punctuation">{</span>
  <span class="token string-property property">'update:modelValue'</span><span class="token operator">:</span> <span class="token punctuation">[</span>value<span class="token operator">:</span> string<span class="token punctuation">]</span>   <span class="token comment">// 带参数</span>
  <span class="token literal-property property">change</span><span class="token operator">:</span> <span class="token punctuation">[</span>index<span class="token operator">:</span> number<span class="token punctuation">]</span>               <span class="token comment">// 数组语法</span>
  <span class="token literal-property property">close</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>                             <span class="token comment">// 无参数</span>
<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 2. 触发事件</span>
<span class="token keyword">function</span> <span class="token function">onInput</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">e</span><span class="token operator">:</span> Event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'update:modelValue'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>target <span class="token keyword">as</span> HTMLInputElement<span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="v-model与多值绑定-vue-3-4-新特性"><a href="#v-model与多值绑定-vue-3-4-新特性" class="header-anchor">#</a> V-model与多值绑定（Vue 3.4+ 新特性）</h2> <ol><li>语法
<code>&lt;input v-model=&quot;a&quot; v-model=&quot;b&quot;&gt;</code>
• 同一标签可同时绑定多个 v-model，实际等价于：
<code>&lt;input :value=&quot;a&quot; @input=&quot;a=$event.target.value&quot; :value=&quot;b&quot; @input=&quot;b=$event.target.value&quot;&gt;</code>
• 仅对原生 <code>&lt;input&gt;</code>、<code>&lt;textarea&gt;</code>、<code>&lt;select&gt;</code> 生效。</li> <li>使用场景
• 双向绑定多个简单值，避免额外包裹对象。
• 注意：顺序决定绑定优先级；同名属性后写覆盖先写。</li></ol> <h2 id="vuex-vs-pinia"><a href="#vuex-vs-pinia" class="header-anchor">#</a> Vuex vs Pinia</h2> <table><thead><tr><th>维度</th> <th>Vuex</th> <th>Pinia</th></tr></thead> <tbody><tr><td><strong>核心思想</strong></td> <td>Flux（State / Mutation / Action / Getter）</td> <td>Composition 思维（Store = reactive + computed + fn）</td></tr> <tr><td><strong>写法复杂度</strong></td> <td>高：需写 <code>mutation</code> + <code>action</code></td> <td>低：直接改 <code>state</code>，无需 <code>mutation</code></td></tr> <tr><td><strong>TS 体验</strong></td> <td>需手写类型声明，推导一般</td> <td>全推断，零配置，类型 100% 精准</td></tr> <tr><td><strong>模块化</strong></td> <td>手动嵌套 <code>modules</code></td> <td>每个 <code>defineStore</code> 天然独立模块</td></tr> <tr><td><strong>体积</strong></td> <td>~8 kB</td> <td>~1 kB</td></tr> <tr><td><strong>组合式 API</strong></td> <td>需 <code>useStore()</code></td> <td>本身就是 Hook，可在 <code>setup</code> 中随意解构</td></tr> <tr><td><strong>插件生态</strong></td> <td>丰富（logger、持久化）</td> <td>官方+社区，插件写法一致</td></tr> <tr><td><strong>Vue 版本</strong></td> <td>Vue2/3 通用</td> <td>官方 Vue3 推荐，Vue2 需桥接</td></tr></tbody></table> <h3 id="vuex-最小模板-vue3-ts"><a href="#vuex-最小模板-vue3-ts" class="header-anchor">#</a> Vuex 最小模板（Vue3 + TS）</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// store/index.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vuex'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">createStore</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function-variable function">state</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> count<span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  mutations<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token function-variable function">inc</span><span class="token operator">:</span> s <span class="token operator">=&gt;</span> s<span class="token punctuation">.</span>count<span class="token operator">++</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  actions<span class="token operator">:</span>   <span class="token punctuation">{</span> <span class="token function">asyncInc</span><span class="token punctuation">(</span><span class="token punctuation">{</span> commit <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'inc'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
              <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  getters<span class="token operator">:</span>   <span class="token punctuation">{</span> <span class="token function-variable function">double</span><span class="token operator">:</span> s <span class="token operator">=&gt;</span> s<span class="token punctuation">.</span>count <span class="token operator">*</span> <span class="token number">2</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><div class="language-vue extra-class"><pre class="language-vue"><code><span class="token comment">&lt;!-- Counter.vue --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>{{ $store.state.count }} x2 = {{ $store.getters.double }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>$store.commit('inc')<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>+1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>$store.dispatch('asyncInc')<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>+1 async<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><hr> <h3 id="pinia-最小模板-vue3-ts"><a href="#pinia-最小模板-vue3-ts" class="header-anchor">#</a> Pinia 最小模板（Vue3 + TS）</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// stores/counter.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> defineStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'pinia'</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> useCounter <span class="token operator">=</span> <span class="token function">defineStore</span><span class="token punctuation">(</span><span class="token string">'counter'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> count   <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> double  <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> count<span class="token punctuation">.</span>value <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span>
  <span class="token keyword">function</span> <span class="token function">inc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> count<span class="token punctuation">.</span>value<span class="token operator">++</span> <span class="token punctuation">}</span>
  <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">incAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token builtin">Promise</span></span><span class="token punctuation">(</span>r <span class="token operator">=&gt;</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>r<span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token function">inc</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span> count<span class="token punctuation">,</span> double<span class="token punctuation">,</span> inc<span class="token punctuation">,</span> incAsync <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><div class="language-vue extra-class"><pre class="language-vue"><code><span class="token comment">&lt;!-- Counter.vue --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ts<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span> useCounter <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/stores/counter'</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> count<span class="token punctuation">,</span> double<span class="token punctuation">,</span> inc<span class="token punctuation">,</span> incAsync <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useCounter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>{{ count }} x2 = {{ double }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>inc<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>+1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>incAsync<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>+1 async<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><hr> <h3 id="速记口诀"><a href="#速记口诀" class="header-anchor">#</a> 速记口诀</h3> <ul><li>Vuex：四件套 <code>state / mutation / action / getter</code></li> <li>Pinia：三件套 <code>ref / computed / fn</code>（加一个 <code>defineStore</code>）</li></ul></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/PurpleFish_Blog/assets/js/app.ff8256e3.js" defer></script><script src="/PurpleFish_Blog/assets/js/2.43a24c62.js" defer></script><script src="/PurpleFish_Blog/assets/js/1.6ee28ae7.js" defer></script><script src="/PurpleFish_Blog/assets/js/61.95d9a272.js" defer></script>
  </body>
</html>
