(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{326:function(t,s,a){t.exports=a.p+"assets/img/01-1.eee030bc.png"},346:function(t,s,a){"use strict";a.r(s);var n=a(27),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h2",{attrs:{id:"计算机网络"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#计算机网络"}},[t._v("#")]),t._v(" 计算机网络")]),t._v(" "),s("h4",{attrs:{id:"osi七层协议参考模型"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#osi七层协议参考模型"}},[t._v("#")]),t._v(" OSI七层协议参考模型")]),t._v(" "),s("ol",[s("li",[t._v("应用层（SMTP\\FTP\\HTTP）")]),t._v(" "),s("li",[t._v("表示层（应用层）")]),t._v(" "),s("li",[t._v("会话层（应用层）")]),t._v(" "),s("li",[t._v("传输层（传输层）：TCP\\UDP")]),t._v(" "),s("li",[t._v("网络层（互联网层）：IP")]),t._v(" "),s("li",[t._v("数据链路层（网络接口层）：以太网")]),t._v(" "),s("li",[t._v("物理层（网络接口层）")])]),t._v(" "),s("p",[t._v("发送的数据会在分层模型内传递，每到一层，就会附加该层的包首部–包含该层的协议的相关信息，包括MAC地址、IP地址和端口号。")]),t._v(" "),s("h4",{attrs:{id:"tcp与udp的区别"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#tcp与udp的区别"}},[t._v("#")]),t._v(" TCP与UDP的区别")]),t._v(" "),s("ul",[s("li",[t._v("连接性：TCP面向连接；UDP是无连接的。（TCP需要三次握手，而UDP不需要握手）")]),t._v(" "),s("li",[t._v("可靠性：TCP提供可靠的服务；UDP尽最大努力交付，即不保证可靠交付。（通过TCP连接传送的数据，无差错，不丢失，不重复，且按序到达;UDP则可能出现丢包，不保证顺序到达）")]),t._v(" "),s("li",[t._v("面向对象：TCP面向字节流;UDP是面向报文的。（ 面向报文的是指发送方的UDP对应用层交下来的数据报文，不合并不拆分，只是在其上面加上首部后就交给了下面的网络层。）。")]),t._v(" "),s("li",[t._v("差错拥塞控制：UDP没有差错和拥塞控制，因此网络出现拥塞不会使源主机的发送速率降低。（TCP拥塞控制，当另一端出现阻塞时，会降低发送速率）。")]),t._v(" "),s("li",[t._v("系统开销：TCP首部开销20字节（具有报文段序号，应答序号，窗口大小等）;UDP的首部开销小，只有8个字节（2个字节的源端口，2个字节的目的端口，2个字节的报文长度，2个字节的校验和）。")]),t._v(" "),s("li",[t._v("信道：TCP的逻辑通信信道是全双工的可靠信道，即可以流入也可以流出的信道；UDP则是不可靠信道。")]),t._v(" "),s("li",[t._v("有序性：TCP是有序的字节流；UDP则是无序的。（这是由于tcp头部存在报文段的序号，而udp没有）")])]),t._v(" "),s("h5",{attrs:{id:"tcp三次挥手"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#tcp三次挥手"}},[t._v("#")]),t._v(" TCP三次挥手")]),t._v(" "),s("p",[s("img",{attrs:{src:a(326),alt:"img"}})]),t._v(" "),s("h5",{attrs:{id:"dns缓存"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#dns缓存"}},[t._v("#")]),t._v(" DNS缓存")]),t._v(" "),s("p",[t._v("(浏览器、系统、ISP、路由器、DNS服务器）\n在一个请求链中，当某DNS服务器接收到一个DNS回答，它能将该回答中的信息缓存在本地存储器中。如果在DNS服务器中缓存了一台主机名/IP地址对，另一对相同主机名的查询到达该DNS服务器时，该DNS服务器就能够提供所需要的IP地址，即使它不是该主机名的权威服务器。由于主机名与IP地址之间的映射不是永久的，DNS服务器在一段时间之后将丢失缓存的信息。")]),t._v(" "),s("h4",{attrs:{id:"http状态码"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#http状态码"}},[t._v("#")]),t._v(" HTTP状态码")]),t._v(" "),s("p",[t._v("HTTP 400 – 请求无效")]),t._v(" "),s("p",[t._v("HTTP 401.1 – 未授权：登录失败")]),t._v(" "),s("p",[t._v("HTTP 401.2 – 未授权：服务器配置问题导致登录")]),t._v(" "),s("p",[t._v("HTTP 401.3 – ACL 禁止访问资源")]),t._v(" "),s("p",[t._v("HTTP 401.4 – 未授权：授权被筛选器拒绝")]),t._v(" "),s("p",[t._v("HTTP 401.5 – 未授权：ISAPI 或 CGI 授权失败")]),t._v(" "),s("p",[t._v("HTTP 403 – 禁止访问")]),t._v(" "),s("p",[t._v("HTTP 403 – 对 Internet 服务管理器 的访问仅限于 Localhost")]),t._v(" "),s("p",[t._v("HTTP 403.1 禁止访问：禁止可执行访问")]),t._v(" "),s("p",[t._v("HTTP 403.2 – 禁止访问：禁止读访问")]),t._v(" "),s("p",[t._v("HTTP 403.3 – 禁止访问：禁止写访问")]),t._v(" "),s("p",[t._v("HTTP 403.4 – 禁止访问：要求 SSL")]),t._v(" "),s("p",[t._v("HTTP 403.5 – 禁止访问：要求 SSL 128")]),t._v(" "),s("p",[t._v("HTTP 403.6 – 禁止访问：IP 地址被拒绝")]),t._v(" "),s("p",[t._v("HTTP 403.7 – 禁止访问：要求客户证书")]),t._v(" "),s("p",[t._v("HTTP 403.8 – 禁止访问：禁止站点访问")]),t._v(" "),s("p",[t._v("HTTP 403.9 – 禁止访问：连接的用户过多")]),t._v(" "),s("p",[t._v("HTTP 403.10 – 禁止访问：配置无效")]),t._v(" "),s("p",[t._v("HTTP 403.11 – 禁止访问：密码更改")]),t._v(" "),s("p",[t._v("HTTP 403.12 – 禁止访问：映射器拒绝访问")]),t._v(" "),s("p",[t._v("HTTP 403.13 – 禁止访问：客户证书已被吊销")]),t._v(" "),s("p",[t._v("HTTP 403.15 – 禁止访问：客户访问许可过多")]),t._v(" "),s("p",[t._v("HTTP 403.16 – 禁止访问：客户证书不可信或者无效")]),t._v(" "),s("p",[t._v("HTTP 403.17 – 禁止访问：客户证书已经到期或者尚未生效")]),t._v(" "),s("p",[t._v("HTTP 404.1 - 无法找到 Web 站点")]),t._v(" "),s("p",[t._v("HTTP 404- 无法找到文件")]),t._v(" "),s("p",[t._v("HTTP 405 – 资源被禁止")]),t._v(" "),s("p",[t._v("HTTP 406 – 无法接受")]),t._v(" "),s("p",[t._v("HTTP 407 – 要求代理身份验证")]),t._v(" "),s("p",[t._v("HTTP 410 – 永远不可用")]),t._v(" "),s("p",[t._v("HTTP 412 – 先决条件失败")]),t._v(" "),s("p",[t._v("HTTP 414 – 请求 – URI 太长 HTTP 500 – 内部服务器错误")]),t._v(" "),s("p",[t._v("HTTP 500.100 – 内部服务器错误 – ASP 错误")]),t._v(" "),s("p",[t._v("HTTP 500-11 服务器关闭")]),t._v(" "),s("p",[t._v("HTTP 500-12 应用程序重新启动")]),t._v(" "),s("p",[t._v("HTTP 500-13 – 服务器太忙")]),t._v(" "),s("p",[t._v("HTTP 500-14 – 应用程序无效")]),t._v(" "),s("p",[t._v("HTTP 500-15 – 不允许请求 global.asa")]),t._v(" "),s("p",[t._v("Error 501 – 未实现")]),t._v(" "),s("p",[t._v("HTTP 502 – 网关错误")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("这些状态代码表示临时的响应。客户端在收到常规响应之前，应准备接收一个或多个 1xx 响应。 100 – 继续。\n101 – 切换协议。")]),t._v(" "),s("p",[t._v("2xx – 成功 这类状态代码表明服务器成功地接受了客户端请求。")]),t._v(" "),s("p",[t._v("200 – 确定。客户端请求已成功。")]),t._v(" "),s("p",[t._v("201 – 已创建。")]),t._v(" "),s("p",[t._v("202 – 已接受。")]),t._v(" "),s("p",[t._v("203 – 非权威性信息。")]),t._v(" "),s("p",[t._v("204 – 无内容。")]),t._v(" "),s("p",[t._v("205 – 重置内容。")]),t._v(" "),s("p",[t._v("206 – 部分内容。")]),t._v(" "),s("p",[t._v("3xx – 重定向 客户端浏览器必须采取更多操作来实现请求。例如，浏览器可能不得不请求服务器上的不同的页面，或通过代理服务器重复该请求。")]),t._v(" "),s("p",[t._v("302 – 对象已移动。")]),t._v(" "),s("p",[t._v("304 – 未修改。")]),t._v(" "),s("p",[t._v("307 – 临时重定向")]),t._v(" "),s("p",[t._v("4xx – 客户端错误")])])]),t._v(" "),s("h2",{attrs:{id:"缓存机制-详细笔记-强缓存-协商缓存"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#缓存机制-详细笔记-强缓存-协商缓存"}},[t._v("#")]),t._v(" 缓存机制 详细笔记 强缓存  协商缓存")]),t._v(" "),s("h3",{attrs:{id:"_5-1-强缓存"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-强缓存"}},[t._v("#")]),t._v(" 5.1 强缓存")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("Expires")]),t._v("（HTTP/1.0） ：指定过期日期")]),t._v(" "),s("li",[s("strong",[t._v("Cache-Control: max-age")]),t._v("：指定有效期（相对时间）")])]),t._v(" "),s("p",[t._v("（命中强缓存，浏览器不会向服务器发送请求）")]),t._v(" "),s("h3",{attrs:{id:"_5-2-协商缓存"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-协商缓存"}},[t._v("#")]),t._v(" 5.2 协商缓存")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("Last-Modified / If-Modified-Since")])]),t._v(" "),s("li",[s("strong",[t._v("ETag / If-None-Match")])])]),t._v(" "),s("p",[t._v("（浏览器携带校验信息向服务器询问是否有变更，未变更返回304）")]),t._v(" "),s("h2",{attrs:{id:"jwt"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#jwt"}},[t._v("#")]),t._v(" jwt")]),t._v(" "),s("h3",{attrs:{id:"前端只需要会-5-件事"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#前端只需要会-5-件事"}},[t._v("#")]),t._v(" 前端只需要会 5 件事")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",{staticStyle:{"text-align":"left"}},[t._v("#")]),t._v(" "),s("th",{staticStyle:{"text-align":"left"}},[t._v("任务")]),t._v(" "),s("th",{staticStyle:{"text-align":"left"}},[t._v("必须知道的 API / 概念")])])]),t._v(" "),s("tbody",[s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("1")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("登录拿令牌")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("code",[t._v("fetch/axios.post('/login')")]),t._v(" 拿到 "),s("code",[t._v("accessToken")]),t._v("、"),s("code",[t._v("refreshToken")])])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("2")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("存令牌")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("code",[t._v("document.cookie = ...")]),t._v(" 或 "),s("code",[t._v("localStorage.setItem")])])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("3")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("发请求带令牌")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("code",[t._v("axios.defaults.headers.common['Authorization'] = Bearer xxx")])])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("4")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("令牌过期自动续")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("拦截器 401→调用 "),s("code",[t._v("/refresh")]),t._v("→重试原请求")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("5")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("退出登录")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("清令牌 + 调 "),s("code",[t._v("/logout")])])])])]),t._v(" "),s("hr"),t._v(" "),s("h3",{attrs:{id:"_20-行骨架代码-可直接用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_20-行骨架代码-可直接用"}},[t._v("#")]),t._v(" 20 行骨架代码（可直接用）")]),t._v(" "),s("div",{staticClass:"language-ts extra-class"},[s("pre",{pre:!0,attrs:{class:"language-ts"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" axios "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'axios'")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ====== 1. 存/取 ======")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("setTokens")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("a"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" r"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  document"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cookie "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token template-string"}},[s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("access=")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("a"),s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("; path=/; SameSite=Lax")]),s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),t._v("\n  document"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cookie "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token template-string"}},[s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("refresh=")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("r"),s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("; path=/; SameSite=Lax")]),s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("getCookie")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v("\n  document"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cookie"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("match")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RegExp")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token template-string"}},[s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("(^| )")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("=([^;]*)")]),s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?.")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ====== 2. 请求拦截器：自动带令牌 ======")]),t._v("\naxios"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("interceptors"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("use")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cfg "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  cfg"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("headers"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Authorization'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token template-string"}},[s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("Bearer ")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getCookie")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'access'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" cfg\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ====== 3. 响应拦截器：过期自动刷新 ======")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" isRefreshing "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\naxios"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("interceptors"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("response"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("use")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  r "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" r"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" err "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" cfg "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" err"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("config\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("err"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("response"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?.")]),t._v("status "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("401")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("cfg"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_retry"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      cfg"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_retry "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("isRefreshing"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        isRefreshing "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" data "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" axios"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("post")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/auth/refresh'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" refreshToken"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getCookie")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'refresh'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTokens")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("accessToken"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("refreshToken"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("finally")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          isRefreshing "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("axios")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cfg"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 重发原请求")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("Promise")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("reject")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("err"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ====== 4. 登录 ======")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("login")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("user"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" pwd"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" data "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" axios"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("post")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/auth/login'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" user"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" pwd "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTokens")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("accessToken"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("refreshToken"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ====== 5. 退出 ======")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("logout")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  axios"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("post")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/auth/logout'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" refreshToken"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getCookie")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'refresh'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  document"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cookie "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'access=; path=/; max-age=0'")]),t._v("\n  document"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cookie "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'refresh=; path=/; max-age=0'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("hr"),t._v(" "),s("h3",{attrs:{id:"📦-额外-3-个可选工具包"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#📦-额外-3-个可选工具包"}},[t._v("#")]),t._v(" 📦 额外 3 个可选工具包")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("js-cookie")]),t._v("："),s("code",[t._v("Cookies.set('access', token)")]),t._v("（防手写正则）")]),t._v(" "),s("li",[s("strong",[t._v("jwt-decode")]),t._v("：前端解码 payload，提前判断过期")]),t._v(" "),s("li",[s("strong",[t._v("zustand / pinia")]),t._v("：把令牌放全局状态，跨组件共享")])]),t._v(" "),s("hr"),t._v(" "),s("h3",{attrs:{id:"🧠-记住-3-个核心口诀"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#🧠-记住-3-个核心口诀"}},[t._v("#")]),t._v(" 🧠 记住 3 个核心口诀")]),t._v(" "),s("ol",[s("li",[s("strong",[t._v("登录拿双 token")]),t._v("（access + refresh）")]),t._v(" "),s("li",[s("strong",[t._v("cookie 带 SameSite=Lax")]),t._v("（防 CSRF）")]),t._v(" "),s("li",[s("strong",[t._v("401 自动刷新")]),t._v("（拦截器里做重试）")])])])}),[],!1,null,null,null);s.default=e.exports}}]);